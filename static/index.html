<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agentic Timetable Planner</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="stylesheet" href="/static/auth.css">
</head>
<body>
    <!-- Auth Modal -->
    <div id="auth-modal" class="auth-modal active">
        <div class="auth-container">
            <div class="auth-header">
                <h2>üîê Authentication Required</h2>
                <p style="margin-top: 10px; color: #666; font-size: 0.9em;">Please sign in to access the Timetable Planner</p>
            </div>
            
            <div class="auth-tabs">
                <div class="auth-tab active" data-tab="login" onclick="switchAuthTab('login')">Login</div>
                <div class="auth-tab" data-tab="signup" onclick="switchAuthTab('signup')">Sign Up</div>
            </div>
            
            <!-- Login Form -->
            <form id="login-form" class="auth-form active" onsubmit="loginWithEmail(event)">
                <div id="login-error" class="auth-error"></div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="login-email" required placeholder="your@email.com">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="login-password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button type="submit" class="auth-button">Login</button>
                
                <div class="auth-divider"><span>OR</span></div>
                
                <button type="button" class="google-signin-button" onclick="signInWithGoogle()">
                    <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg"><g fill="#000" fill-rule="evenodd"><path d="M9 3.48c1.69 0 2.83.73 3.48 1.34l2.54-2.48C13.46.89 11.43 0 9 0 5.48 0 2.44 2.02.96 4.96l2.91 2.26C4.6 5.05 6.62 3.48 9 3.48z" fill="#EA4335"></path><path d="M17.64 9.2c0-.74-.06-1.28-.19-1.84H9v3.34h4.96c-.10.83-.64 2.08-1.84 2.92l2.84 2.20c1.70-1.57 2.68-3.88 2.68-6.62z" fill="#4285F4"></path><path d="M3.88 10.78A5.54 5.54 0 0 1 3.58 9c0-.62.11-1.22.29-1.78L.96 4.96A9.008 9.008 0 0 0 0 9c0 1.45.35 2.82.96 4.04l2.92-2.26z" fill="#FBBC05"></path><path d="M9 18c2.43 0 4.47-.80 5.96-2.18l-2.84-2.20c-.76.53-1.78.90-3.12.90-2.38 0-4.40-1.57-5.12-3.74L.97 13.04C2.45 15.98 5.48 18 9 18z" fill="#34A853"></path><path fill="none" d="M0 0h18v18H0z"></path></g></svg>
                    Sign in with Google
                </button>
            </form>
            
            <!-- Signup Form -->
            <form id="signup-form" class="auth-form" onsubmit="signupWithEmail(event)">
                <div id="signup-error" class="auth-error"></div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="signup-email" required placeholder="your@email.com">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="signup-password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="6">
                </div>
                <div class="form-group">
                    <label>Confirm Password</label>
                    <input type="password" id="signup-confirm-password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="6">
                </div>
                <button type="submit" class="auth-button">Create Account</button>
                
                <div class="auth-divider"><span>OR</span></div>
                
                <button type="button" class="google-signin-button" onclick="signInWithGoogle()">
                    <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg"><g fill="#000" fill-rule="evenodd"><path d="M9 3.48c1.69 0 2.83.73 3.48 1.34l2.54-2.48C13.46.89 11.43 0 9 0 5.48 0 2.44 2.02.96 4.96l2.91 2.26C4.6 5.05 6.62 3.48 9 3.48z" fill="#EA4335"></path><path d="M17.64 9.2c0-.74-.06-1.28-.19-1.84H9v3.34h4.96c-.10.83-.64 2.08-1.84 2.92l2.84 2.20c1.70-1.57 2.68-3.88 2.68-6.62z" fill="#4285F4"></path><path d="M3.88 10.78A5.54 5.54 0 0 1 3.58 9c0-.62.11-1.22.29-1.78L.96 4.96A9.008 9.008 0 0 0 0 9c0 1.45.35 2.82.96 4.04l2.92-2.26z" fill="#FBBC05"></path><path d="M9 18c2.43 0 4.47-.80 5.96-2.18l-2.84-2.20c-.76.53-1.78.90-3.12.90-2.38 0-4.40-1.57-5.12-3.74L.97 13.04C2.45 15.98 5.48 18 9 18z" fill="#34A853"></path><path fill="none" d="M0 0h18v18H0z"></path></g></svg>
                    Sign up with Google
                </button>
            </form>
        </div>
    </div>
    
    <div class="container" style="display: none;" id="main-app">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1>üéì Agentic Timetable Planner</h1>
                    <p>AI-powered university timetable generation using Google Gemini</p>
                </div>
                <div>
                    <!-- User Profile (shown when logged in) -->
                    <div id="user-profile" class="user-profile">
                        <div id="user-avatar" class="user-avatar">U</div>
                        <div class="user-info">
                            <div id="user-name" class="user-name">User</div>
                            <div id="user-email" class="user-email">user@email.com</div>
                        </div>
                        <button class="logout-button" onclick="logout()">Logout</button>
                    </div>
                    <!-- Login Button (shown when logged out) -->
                    <button id="login-button" class="auth-button" onclick="showAuthModal()" style="padding: 12px 24px; width: auto;">
                        üîê Login
                    </button>
                </div>
            </div>
        </header>

        <div class="dashboard">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Faculty</h3>
                    <div class="stat-value" id="faculty-count">0</div>
                </div>
                <div class="stat-card">
                    <h3>Subjects</h3>
                    <div class="stat-value" id="subjects-count">0</div>
                </div>
                <div class="stat-card">
                    <h3>Classrooms</h3>
                    <div class="stat-value" id="classrooms-count">0</div>
                </div>
                <div class="stat-card">
                    <h3>Sections</h3>
                    <div class="stat-value" id="sections-count">0</div>
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- Upload Section -->
            <div class="section">
                <h2>üì§ Upload Data</h2>
                <div class="upload-grid">
                    <div class="upload-card">
                        <h3>Faculty</h3>
                        <input type="file" id="faculty-file" accept=".csv,.json">
                        <button onclick="uploadFile('faculty')">Upload Faculty</button>
                        <p class="help-text">CSV/JSON with: id, name, email, department, subjects_can_teach</p>
                    </div>
                    <div class="upload-card">
                        <h3>Subjects</h3>
                        <input type="file" id="subjects-file" accept=".csv,.json">
                        <button onclick="uploadFile('subjects')">Upload Subjects</button>
                        <p class="help-text">CSV/JSON with: id, name, code, department, credits, hours_per_week</p>
                    </div>
                    <div class="upload-card">
                        <h3>Classrooms</h3>
                        <input type="file" id="classrooms-file" accept=".csv,.json">
                        <button onclick="uploadFile('classrooms')">Upload Classrooms</button>
                        <p class="help-text">CSV/JSON with: id, name, building, capacity, room_type</p>
                    </div>
                    <div class="upload-card">
                        <h3>Sections</h3>
                        <input type="file" id="sections-file" accept=".csv,.json">
                        <button onclick="uploadFile('sections')">Upload Sections</button>
                        <p class="help-text">CSV/JSON with: id, name, program, year, semester, num_students, subjects</p>
                    </div>
                </div>
            </div>

            <!-- Generate Timetable Section -->
            <div class="section">
                <h2>ü§ñ Generate Timetable</h2>
                <div class="generate-form">
                    <div class="form-group">
                        <label for="academic-year">Academic Year:</label>
                        <input type="text" id="academic-year" placeholder="2024-2025" value="2024-2025">
                    </div>
                    <div class="form-group">
                        <label for="semester">Semester:</label>
                        <select id="semester">
                            <option value="1">1</option>
                            <option value="2">2</option>
                        </select>
                    </div>
                    <button class="btn-primary" onclick="generateTimetable()">Generate Timetable</button>
                </div>
                <div id="generation-status" class="status-message"></div>
            </div>

            <!-- Chat Interface -->
            <div class="section">
                <h2>üí¨ Chat Assistant</h2>
                <div class="chat-container">
                    <div id="chat-messages" class="chat-messages">
                        <div class="message bot">
                            <strong>Assistant:</strong> Hello! I'm your timetable planning assistant. Upload your data and I'll help you generate an optimal timetable.
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <input type="text" id="chat-input" placeholder="Ask me anything about timetable planning..." 
                               onkeypress="handleChatKeypress(event)">
                        <button onclick="sendMessage()">Send</button>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div class="section" id="results-section" style="display: none;">
                <h2>üìã Generated Timetable</h2>
                <button onclick="scrollToTop()" style="float: right; background: #667eea; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">
                    ‚¨ÜÔ∏è Back to Top
                </button>
                <div style="clear: both;"></div>
                <div id="timetable-results"></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module" src="/static/firebase-config.js"></script>
    <script src="/static/auth.js"></script>
    <script src="/static/app.js"></script>
</body>
</html>
